<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html;charset=Shift_JIS">
<TITLE>ひとりごと</TITLE>
</HEAD>
<BODY>
<H4 align=left>ひとりごと</H4>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/31<BR>○謎<BR>　この時期に毎年書く文章で、初めていい文章が書けた。しかし、来年もこの文章を使おうと思った時点で負けている自分がいる。<BR>○センサー<BR>　地道に調べごと。だいたいデータシートどおり。<BR>○生活<BR>　袋をスキャナで読み込んで文字の位置決めをして印刷。便利。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/30<BR>○センサー<BR>　難しいことを考えずに素直に実装したほうがよさそうな気がしてきた。もう少し実験してみる。<BR>　ジャイロがすぐに飽和してしまう。これはちょっと失敗したかな、、、。<BR>　データの記録にはSDとか便利だな。でも、なんかプログラムを作る気力が出ない。<BR>　Excelで検討してるけど、ScilabとかScicosで検討できると素敵なんだろうなぁ。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/29<BR>○電話<BR>　家にマンション経営のよくかかってくるやつが。今回はかなりしつこかった。普通なら会社にかけて来るが、何箇所か移っているんでまずかかって来ないでしょう（実際にかかってこない）。<BR>　切ればしつこくかけてくるし、話を聞けば会いましょうとなるし、困ったもんだ。会社で怒っていた某氏の気持ちがよく分かるぞ。<BR>　しかし、最初に社名を名乗らなかったでしょ、と指摘したら普段は名乗ってるだと。嘘つけ。<BR>○センサー<BR>　すでにミスが発覚。サンプリング周期が間違ってた。どうりで変な波形だったわけだ。オーバーシュートはあいかわらずあるが、電源投入直後の立ち上がりが速い部分なので問題なし。あとはジャイロで補正。<BR>　安直にやってはうまく行かない。そりゃそうだ。もっと精進しよう。<BR>○ロボット<BR>　足裏110mmはきついなぁ。うさぎ跳びは自分の脚の構造上ちょっときついなぁ。しかも、前庭器（？）役に立たないじゃん。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/28<BR>○いろいろ<BR>　今日いろいろ解決しようと思ったが、外乱が多くて集中できない。<BR>○センサー<BR>　フィルターを一個実装。まだ予備試験用。<BR>　テスト用コードを書く。ファイル出力ルーチンとか、文字列処理とかわけわからなくなってきた。コードサイズなんか考えずにライブラリを使うべきかなぁ。<BR>　位相がずれるんで、オーバーシュートがあるなぁ。わかってたけど、結構大きいなぁ。演算誤差も気になるけど、それはまぁいいか。もうちょっと考えるか。<BR>　しかし、デジタルフィルターもソフトで簡単に設計できるなぁ。いい時代だなぁ。落とし穴は多そうだけど。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/27<BR>○チョロメテ<BR>　すごいなぁ。３軸力センサとかARTLinuxとかものってるのか。しかし、これで重さが1.5Kgなんていったいどうやったら出来るんだろう？<BR>○謎<BR>　おいしゅうございました。しかし、食いすぎておなかいっぱい。<BR>　微妙に体調が悪い気がするなぁ。<BR>○scilab&amp;scicos<BR>　こっちの方が遊べるんじゃないだろうか、、、？scicosの使い方がいまいち分からないけど。<BR>○センサー<BR>　フィルターを実装開始。あと、MicroSDはBSPI1につなげることにして、使えるUARTを一個増やすことにした。MicroSDを使うときはADが使えないけど、まぁそれはそれでしょうがないかなと。<BR>○センサー2<BR>　秋月に新しい加速度センサーが。そのうち買おうかなぁ。手元に加速度センサーばかりたまっていく、、、。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/25<BR>○StarTrek<BR>　ベストエピソードコレクション買いました。これ、次からは1990円なんだよなぁ。80巻出るらしけど、微妙な値段だよなぁ。普通にボックス買うのとそんなに値段が変わらない気がするなぁ。まぁ、全シリーズ買うと大変なことになるんだが。本はまだ読んでないけど、これぐらいの量で毎回付いてくるんならいいかなぁ。<BR>　セブンオブナイン等身大マネキンが何名様に当たるか気になるなぁ（あまりほしくないけどね）。<BR>○謎<BR>　特許とかあってもマニュアルや部品が入手できればメンテナンスできるわけだし、逆に特許が無くてもブラックボックスならお手上げと思う。<BR>　特許が工法に関係しているなら、言っていることの意味は分かるんだが。というか、この話は本来、工法についての話じゃないのかなぁ。なんとなく、手段の目的化に近いものを感じるなぁ。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/24<BR>○謎<BR>　昨日からおなかの調子が悪い。金曜日の生肉の影響か？</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/23<BR>○STR711 
  MicroSD<BR>　連続書き込み読み出しテスト。なぜか最初の数回は失敗で、そのあとは失敗しない。まだどこかタイミングがやばい部分がある気がする。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/22<BR>○STR711 
  MicroSD<BR>　バッファーを効率よく使って書き込み部分をさらにチューニング。しかし、いろいろタイミングを誤ったらしく、FATがおかしくなったようだ。そこで、windowsのchkdskでディスクを修復すると、windowsでは読み書きできるが、マイコンではなぜか書き込むことが出来ない。<BR>　ファイルをコピーしてリネームすると書き込めた。<BR>　これ以上チューニングしても速度向上はわずかなので、もうやめたほうがよさそうだ。<BR>　いままでコンパイラの最適化を使うと正常に動かないことが多いので嫌っていたが、最適化によってたまたま通っていた（周辺の）フラグクリアなどのタイミングのミスが分かった。これまで最適化後に動かないとコンパイラのせいにしていたが、自分が悪かったわけやね。しかし、賢い最適化のせいでデバッグはやりにくくなった。<BR>　I2cEEPROM＋似非FATは速度が予想できるが、SD+FATになると予測できないなぁ。悩むところだなぁ。SDはバックアップなどに使うほうが現実的かなぁ。だんだんそんな気がしてきたぞ。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/21<BR>○STR711 
  MicroSD<BR>　少しずつチューニング。BSPI使って多少速くなってきた。クロックを4MHzから8MHzに上げてもたいして性能向上しないのでもうしょうがないかな。当然だけど、読み込みが100byteとかだと性能激減。<BR>○Linux 
  on 
  DSO<BR>　udevだったっけ？を少しさわってUSBなttyが普通にアクセスできるようにした。変更箇所は意外と簡単に分かったが、emacsの使い方を全然覚えていない事実が判明。もともとそんなに使い方を知ってるわけじゃなかったが、保存と終了の仕方を忘れていると言うダメダメなレベルに。<BR>○STR711 
  MicroSDその2<BR>　さらにチューニング。BSPIを16bitアクセスで使う。その他、FATファイルシステムモジュールで割り算を使っているところをシフトに置き換えるとかなり速くなった。<BR>　コンパイラで最適化を行うとうま動かななかったが、いろいろ（自分のミスを）見直して動くようになる。速さも向上。これでI2cEEPROM＋似非FATより速くなった。<BR>　でも、まだ読み込みだけなので、これから書き込みの速度向上へ。<BR>　APB1のクロックを24MHzから48MHzに上げたので電流が90mA位になった。まだ大丈夫。クロックを変更してもUARTの設定変更がいらないからライブラリを使うと楽だなぁ。<BR>○日本以外全部沈没<BR>　映画化ってまじですか。河崎実監督ですか。俺はどうすればいいんだろう、、、。同時上映イコちゃんなら絶対見に行く（をぃ）。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/19<BR>○謎<BR>　金山方面で生肉。絶対見てないと思うが、ご馳走様でした。<BR>○STR711 
  BSPI<BR>　クロックの分周比が6以上で偶数のみと言う制約を忘れてはまる。と言うことは、最高で8MHz。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/18<BR>○STR711 
  P0.15<BR>　またまたはまった。P0.15は入力Onlyなのか。Reference Manualじゃ無くてData sheetのPin 
  Description見なくちゃいけなかったのか。また無駄に時間を使っちまった。もう引っかからないぞ。これじゃぁ、基板について文句言っても、マニュアルを読んでないと思われるはな。<BR>　そういえば、Pin 
  Descriptionが見にくい。つかえる場合は×と印がうってあるですよ。見た範囲ではどこにも×がつかえる印とは書いていない。最初見たときは×が使えないということと思った。うじゃうじゃ。P0.15にはなぜか出力に4mAと書いてあるし、これじゃぁ間違うな（と自分を正当化）。<BR>　そういえば、BSPI0はなぜか通常のEnable以外にBoot 
  Configuration 
  Registerもいじらなくちゃいけないんだが、BSPIのところには記述が無い（多分）。そこは知っていたので、あらかじめこれは俺を引っ掛ける罠だと思っていたが、結局別の罠に引っかかってしまった。<BR>　STのSTR7のフォーラムでやっぱりP0.15について出力に出来ないの？というのがあるんで、自分だけじゃないんだなと少し安心。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/17<BR>○SD<BR>　ひとまずBSPI0へカードをつなげてみる。I2CはI2C0へ変更。UART3が使えなくなる。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/16<BR>○SD<BR>　全然動かなかったが、やっと理由が分かった。コネクタ変換基盤の半田付けが不良とは。自分でつけてたら気づく所だけど。いや、本当はなんとなく怪しいと思ってたんだけどね。MicroSDなんて変なもの使うからいけないといえばいけない。でも、ちっちゃくていいよ。カードも安く買えたし（SDやMiniSDより安く。でも、たいていはMicroSDの方が高いと言うか、あまり売ってない）。<BR>　スペック上は結構な速度が出るらしいので、メインに採用しようかなぁと思いはじめる。でも、ロボットのようにバタンバタンと倒れる状況でも使えるんだろうか（コネクタとか）？あと、メインで使うならSPIチャンネルがもう一個いるかなぁと。SPIのピンがI2CとUARTに割り振られているところが悩むところ。<BR>　ロジアナはおもちゃでもあるとそれなりに便利だなぁ。<BR>　まだ読み込みしかしていないが、うまく読めないときがある。まだよく分からない。<BR>○MicroSD<BR>　ソケットにスイッチが無いので挿入状態がわからない。つけっぱなしで使うか毎回初期化すればいいと思うけど、なんとかならんかなぁ。<BR>○インターフェース<BR>　 
  いろいろなところにおまけ基板の問題点が上がっていた。とても勉強になった。<BR>　コネクタの間違いはとてもよくやることだと思った。<BR>　RX1のプルアップはヤバイと思った。<BR>　電源のコンデンサは気をつけようと思った（俺サーボはあんな感じなので。もう手遅れ？）。<BR>○SDその2<BR>　書き込みも出来た。<BR>　このFATファイルシステムモジュールは凄すぎる。感動した。こんな俺でも動いたよ。<BR>　まだディレクトリ関係は試していないが、もう十分な気もする。<BR>　SDのアクセス部分はかなりいい加減に作ったのでもうちょっと作りこもう。今はタイムスタンプが固定だけど、CPUがRTC機能を持っているので使うべきなのか？でも、スタンバイモードとかいろいろ面倒な気がするぞ。また故障箇所が増えるんじゃないか？<BR>　電流がアナログ基板無しで約85mA。しかし、SDカードがあっても無くても電流が変わらないのはどういうわけよ。また何か間違ってるのか？あと、書き込み中に電源を落としたら（やっちゃだめだって）少しおかしくなった。書き込み途中のファイルを消したら問題なくなった。<BR>○生活<BR>　結局今日は予定がこなせませんでした。<BR>○いろいろ<BR>　忘れずに明日もって行きます。感想文よろしく。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/15<BR>○str711<BR>　IDEのライセンスがきた。使ってみたが、なかなかいい感じ。だが、いろいろブラックボックスでデフォルトのインクルードファイルのパスやライブラリのリンクパスが謎で少し気持ち悪い。とか、VC++使いの自分が言うのも変な話だが。<BR>　最初から簡単なスケルトンを作ってくれると最高なんだがなぁ。<BR>　あー、また割り込みがかからない。どうなってるんだ？<BR>　ライブラリのせいか。演算式の評価順ってコンパイラ依存だったっけ？なんかだんだんわけが分からなくなってきた。このライブラリは演算式のきわどいところに括弧が付いてないんで、はまりまくり。たいていはgccのwarningで気づく。しかし、もうどこをどう変更したか分からない。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/14<BR>○str711 i2c 
  eeprom<BR>　書き込んだ直後に読み出しを行うと読み出せない。書き込み時にAcknowledge 
  pollingしてるつもりだけど、出来てないような出来ているような。256バイト以上の書き込みではちゃんと働いてるように見えるし。ウェイトを入れてもいいけど（そもそも書いた直後に読み出すなんてほとんど無いはずだから関係ないけど）、気になりだした。<BR>　サンプルからAcknowledge 
  pollingらし部分をコピーしたらうまくいた。しかし、なぜかは理解していない。フラグを読むタイミングとは思うんだけど、、、。<BR>　DSOのロジアナ機能が役に立ったぜ、といいたいところだけど、あまり役に立たなかった。でも、それが使えることはわかったからよしとしよう。<BR>○SDカード<BR>　LOG保存用にSDカードを付けよおかなと。SPIが2chあるが、片方はUARTと同じピンなので使えない。もう一方はADと通信しているので使えないが、SDと通信中はADは使わないとすればOK。もしくは、汎用ポートで通信か。<BR>　自分ではFATとか作れないので、<A 
  href="http://elm-chan.org/fsw/ff/00index_j.html">http://elm-chan.org/fsw/ff/00index_j.html</A>と<A 
  href="http://elm-chan.org/docs/mmc/mmc.html">http://elm-chan.org/docs/mmc/mmc.html</A>あたりを参考にすれば出来る気がする。ハードに依存する部分が分かれているし、ドキュメントもあるしすばらしい。<BR>　ひとまず汎用ポートで通信するほうが分かりやすい気がする。うん、そうだよな。できるだけトラブルは避けよう。<BR>　コンパイラでwarninngの嵐はよしとして、マイコンにバイナリが書き込めない、、、。OpenOCDが落ちる。なんとかならんものか。<BR>○DSO 
  on 
  Linux<BR>　苦労したが動くことを確認。なんか無理やり動かした気がしないでもない。Linuxは分からんことが多すぎるが、もうそろそろいいかもしれない（なにが）。もう少しGUIが速くなったらなぁ。あとは慣れの問題かなぁ。<BR>○Anglia<BR>　<A 
  href="http://www.st-angliamicro.com/software.asp">http://www.st-angliamicro.com/software.asp</A>ここからOpenOCDのバイナリを持ってきて使ってみると、落ちなかった。書き込みが遅いのはあいかわらずだが。ソースを見て何が違うか調べるべきと思ったが、それは手段の目的化だからやめる。<BR>　なんかだんだん変な方向に行っている気がしてきた。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/13<BR>○str711 
  gcc<BR>　もうとっくにライブラリがgccで使えるようになっていました。IDEもみつけたのですが、メールが送れなくてライセンスが取得できませんでした。<BR>　メールを送ることができました。アドレス間違えてました（をぃ）。ライセンスを取得できるかは分かりません。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/11<BR>○str711 
  i2c0<BR>　一応、買ったところに基板の問題を報告しておいたが、返事は「質問はフォーラムに書き込め。ユーザーがたくさんいる。誰かがアイデアをくれる」（超訳）。しかし、このボードに関したものにはレスがまったく付いてないほど不人気なんで無理でしょう。アイデアもなんも、パターンカットか使わないかしかないわけで。<BR>　i2c1を使うつもりだが、念のため適当にパターンカットした。<BR>　もしかしたらクロックが出てくるのが仕様かもしれない。でも、あまり意味があるとは思えない。<BR>○str711 
  i2c<BR>　サンプルを見ると、本当に最後の2バイト目でACKをDISABLEしてる。1バイトだけ読みたい場合はどうするんだろう？今回は関係ないけど。<BR>　ページリード完了。なんか無駄に時間を使った気がしないでもない。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/10<BR>○str711 
  i2c0<BR>　i2c0のSCLがメインクロックと繋がってるなんてわかるかって言うの。基板のミスか、、、。<BR>　i2c1に変更したら今まで止まっていたところをあっさり通過した。<BR>　またオシロが役に立ったぜ。<BR>　まだ、マニュアルの謎の部分を調べないといけない。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/09<BR>○str711 
  i2c<BR>　flagがクリアできねぇ。デバッガーでメモリを読むとクリアされる。わかんねぇ。アセンブルリストもわかんねぇ。<BR>　また一晩寝たら解決してるかもしれない。そう思おう。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>2006/05/08<BR>○str711 
  i2c<BR>　またもや分からない。どうなってるんだ？<BR>○str711 
  adc<BR>　いやになってきた。何だこの仕様は？電圧監視に使おうと思ったが、やめた。<BR>　とか言いながらまた気が変わったりして。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/07<BR>○センサー<BR>　値がばらつくので電源ラインをオシロで見てみると、ものすごいノイズが。コンデンサを普通の電解からタンタルに変えるとある程度収まる。もしかしたら電解コンデンサが不良だったかも。それでもまだノイズが残るのでだめ。<BR>　今まではノイズをイヤホンで聞いていたが（をぃ）、波形が見れてスペクトルまで見れるのはなんとなく気持ちいい。安物だけど、役に立ったぜ。ただ、プローブがちょっとだめなんで拡張しなくては使いずらい。<BR>　ジャイロの半田付けをしなおしたらノイズが減った。接触不良なのか？加速度センサーはまだノイズがある。原理上仕方がないのかなぁ。データシートのこれで内部のノイズが最小になるぜ！と言うパラメータではそれほど低くならない。<BR>　新しい部品を使うといろいろ面倒だなぁ。ジャイロの温度特性が悪い。データシートに値が書いてないし、いまいちだなぁ。<BR>　予定では、適応フィルターに学習させて、、、のはずだけど、ひとまずここまでにして、次はI2Cに行ってみよう。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/06<BR>○八事裏山<BR>　昨日は中華。サメについての豆知識があったがほとんど覚えてない。物忘れが激しい。<BR>○バグ<BR>　例外の種類と、発生場所のアドレスが分かればだいたい原因は分かるけど、状況を再現出来ないところが気持ち悪い。これで直ったのかなぁ。<BR>○str711<BR>　センサー基板を作ってSPIなADCとBSPIでお話しようと思うが、またもやうまく行かない。落とし穴がある気がするが、注意書きがあまり無い。Philipsはよかったなぁ。<BR>　そうか、SSELはやっぱりHighにしないとバスエラーなのか。あと、サンプルから安易にコピーしちゃいけないな。ちゃんとマニュアル読まないと。<BR>　デバッガーは便利だなぁ。でも結局今週はJTAGのUSB化はしなかったなぁ。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/04<BR>○str711<BR>　昨日リンクできなかったものがあっさりリンクできた。inlineが__inline（と思った）とdefineされているところがあってそこを消したらあっさりと。<BR>　使わない周辺機能のグローバル変数がこれまた使わない関数のためにリンクされる。たかが数バイトなんだが、どうしたものか。何でこうしたのかなぁ。<BR>　あー、そうか。DEBUGが定義してあるからなのか。そういえば、昨日いろいろ試してた時にそうしたんだ。なるほど。<BR>　mapファイルを見ると使ってない関数も含まれてるなぁ。また自分の勘違いの予感がするなぁ。<BR>○ライブラリ<BR>　GCCへの移植みたいなものは終わった。しかし、直接レジスタをたたいたほうが早いんじゃないだろうか？しかもその方がオブジェクトサイズも小さくなる。個人的にはその方が見通しがいい。<BR>○ライブラリ2<BR>　いろいろ移植。EZ-ARM用に作ったものがかなり変更しないと利用できない。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/03<BR>○str711<BR>　順調。だんだん慣れてきた。PythonでOpenOCDにtelnetでつなげてflashに書き込むスクリプトを作ってみたり。<BR>　面倒になってきたのでSTにあったライブラリでも使ってみようかな。<BR>　今度こそ分からない。ヘッダーファイルでinline宣言されている関数が普通にリンクされてる感じでリンカが文句を言ってくる（多分）。なんか勘違いしている気もするが。<BR>　今度こそ挫折するぞ。調べるのがめんどくさい。コンパイラが違うから仕方がないんだ。そういうことにしておこう。別にライブラリなんか使わなくてもかまわないじゃないか。マイコンのレジスタと16進数でお話したほうが楽しいよ。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/02<BR>○str711<BR>　GPIOは気にいった。出力はOD,PushPull,入力はCMOS,TTL,PullUp,PullDown自由自在。同じピンにUARTのRXとTXが割り振られているのにも意味があったんだ。うまく使えれば楽しそう。<BR>　他の周辺機能はいまいちな気がしないでもないが、なんかだんだん愛着がわいてきたぞ。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" 
  align=left>2006/05/01<BR>○生活<BR>　36サーボ返済。うまく行けばいくらかは戻ってくる。また書類が必要か。とほほ。<BR>○str711<BR>　ごめんなさい。特徴の一つのUSBコネクタをはずしてしまいました。今回は使わないと言うことで。電源コネクタつけなくては。<BR>　関係ないけど、DMAが無いのが悩ましいなぁ。<BR>○OpenOCD<BR>　私が調査不足でした。ドキュメントはちゃんとありました。ぼちぼち使い方を勉強します。</P>
  <P dir=ltr style="MARGIN-RIGHT: 0px" align=left>&nbsp;</P><!--StartFragment --></BLOCKQUOTE>
</BODY>
</HTML>
